{% extends 'menu.html' %}

{% block title %}Issues Monitoring{% endblock %}

{% block header %}
<link rel="stylesheet" href="/static/jquery-ui/jquery-ui.min.css">
<link rel="stylesheet" type="text/css" href="/static/css/form.css" />
<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/bootstrap/3/css/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.css" />
{% endblock %}

{% block js %}
<script src="/static/jquery-ui/jquery-ui.min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.js"></script>
<script type="text/javascript">
$(function() {
    $('input[name="daterange"]').daterangepicker({
        timePicker: true,
        timePicker24Hour: true,
        timePickerSeconds: true,
        locale: {
            format: 'DD/MM/YYYY HH:mm:ss'
        }
    });


  var mydata = JSON.parse('{{temp_data}}' || "[]");

  var temporaria = '{{temp_data}}';
  console.log("hahahahaah")
  console.log(mydata.length);
  function drawChart() {
    var data = new google.visualization.DataTable(); 
    data.addColumn('number', 'index');
    data.addColumn('number', 'mean');
    data.addColumn({id: 'min', type:'number', role: 'interval'});
    data.addColumn({id: 'max', type:'number', role: 'interval'});

    data.addRows(mydata);


    /*var options = {
      title: 'Gráfico de Temperatura e Umidade',
      curveType: 'function',
      legend: { position: 'bottom' }
    };*/

    var options = {
        title:'Grafico',
        curveType:'function',
        lineWidth: 4,
        series: [{'color': '#D3362D'}],
        intervals: { 'lineWidth':2, 'barWidth': 0.5 },
        legend: 'none',
    };

    var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

    chart.draw(data, options);
  }

  if (mydata.length > 0) {
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);
  } else {
      document.getElementById('curve_chart').remove();
      document.getElementById('warning-chart').style = "";
  }

});

</script>
{% endblock %}

{% block content %}
<div id="nav-bar">

    <div class="page-title">
        <h3>Gráfico</h3>
        <h4>{{lab_nome}}</h4>
    </div>
    {% if error_message %}
    <div class="ui-widget error-msg">
        <div class="ui-state-error ui-corner-all" style="padding: 0 .7em;">
            <p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em; margin-top: .04em"></span>
            <strong>Erro: </strong>{{error_message}}</p>
        </div>
    </div>
    {% endif %}
    <div class="neat-form">
        <form method="POST">
            <fieldset>
                <div class="legenda-cadastro">Tipo do gráfico:</div>
                <div class="graphic_mode">
                    <input type="radio" name="chart_type" value="temperatura">Temperatura
                    <input type="radio" name="chart_type" value="umidade">Umidade
                </div>
                <div class="legenda-cadastro">Data de início e fim:</div>
                <input type="text" name="daterange" value="17/06/2017 00:00:00 - 18/06/2017 12:00:03" />
                <div class="legenda-cadastro">Intervalo do gráfico (em min):</div>
                <input type="text" name="intervalo_grafico" id="intervalo_grafico">
            </fieldset>
            <input type="submit" id="graphic" value="Gerar gráfico" />
        </form>
    </div>

    <div id="curve_chart" style="width: 900px; height: 500px"></div>
    <div class="ui-widget msg" id="warning-chart" style="display: hidden;">
        <div class="ui-state-warning ui-corner-all" style="padding: 0 .7em;">
            <p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em; margin-top: .04em"></span>
            Não há registros o suficiente para gerar um gráfico.</p>
        </div>
    </div>

    <div class="div-botao-estilizado">
        <a href="{{url_for('laboratorio', id=lab_id, nome=lab_nome)}}" class="btn-estilizado btn-estilizado-blue">Voltar ao Laboratório</a>
    </div>
</div>
{% endblock %}